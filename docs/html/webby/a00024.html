<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WEBBY - the embedded web server with many faces / objects in plain C: WEBBY</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">WEBBY - the embedded web server with many faces / objects in plain C&#160;<span id="projectnumber">Snapshot</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">WEBBY</div>  </div>
</div>
<div class="contents">

<p>embedded web server facade class.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00013.html">tagWEBBY</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00015.html">tagWEBBY_CONNECTION</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#ga6216ff348213b42b05175fdda1b9398f">HTTP_PARSER_BUFFER_SIZE</a>&#160;&#160;&#160;4096</td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="a00013.html">tagWEBBY</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#ga6893c7f44d85f08f5773cadab1d883e7">WEBBY</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="a00015.html">tagWEBBY_CONNECTION</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#ga4db9caaa37abab15b82e31e56f5a363a">WEBBY_CONNECTION</a></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="a00013.html">WEBBY</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#ga24e0938463669691db76aa3a2aba418e">WEBBY_init</a> (<a class="el" href="a00014.html">WEBBY_CONFIG</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#ga294920c6df652655a63a9cd5c368a09f">WEBBY_add_vhost</a> (<a class="el" href="a00013.html">WEBBY</a> *server, const char *host, int port_num, size_t *vhost_idx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#ga63d8c8d948713ccf37e92513e926d8b5">WEBBY_add_filter</a> (<a class="el" href="a00013.html">WEBBY</a> *server, size_t vhost_idx, <a class="el" href="a00006.html">HTTP_FILTER</a> *filter)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#ga6bcdf0577f33a202169d2df9fb2f782d">WEBBY_add_servlet</a> (<a class="el" href="a00013.html">WEBBY</a> *server, <a class="el" href="a00007.html">HTTP_SERVLET</a> *servlet)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#gad219e92389c7104756b0955e39f395a8">WEBBY_run</a> (<a class="el" href="a00013.html">WEBBY</a> *server)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#ga2fff1941b52b1eba9ded25079ecc3c6a">WEBBY_shutdown</a> (<a class="el" href="a00013.html">WEBBY</a> *server)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="a00015.html">WEBBY_CONNECTION</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#ga468f7c2a048c111edea76276865b0f11">WEBBY_new_connection</a> (<a class="el" href="a00013.html">WEBBY</a> *server, void *implconndata)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#ga80d94011f2e61e29fd041437c6dbdf17">WEBBY_connection_data_received</a> (<a class="el" href="a00015.html">WEBBY_CONNECTION</a> *connection)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#ga000431a1b99da08f5711e788533ce0e2">WEBBY_connection_close</a> (<a class="el" href="a00015.html">WEBBY_CONNECTION</a> *connection)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>embedded web server facade class. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga6216ff348213b42b05175fdda1b9398f"></a><!-- doxytag: member="webby.h::HTTP_PARSER_BUFFER_SIZE" ref="ga6216ff348213b42b05175fdda1b9398f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HTTP_PARSER_BUFFER_SIZE&#160;&#160;&#160;4096</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00017_source.html#l00523">523</a> of file <a class="el" href="a00017_source.html">webby.h</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="ga6893c7f44d85f08f5773cadab1d883e7"></a><!-- doxytag: member="webby.h::WEBBY" ref="ga6893c7f44d85f08f5773cadab1d883e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="a00013.html">tagWEBBY</a>  <a class="el" href="a00013.html">WEBBY</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ga4db9caaa37abab15b82e31e56f5a363a"></a><!-- doxytag: member="webby.h::WEBBY_CONNECTION" ref="ga4db9caaa37abab15b82e31e56f5a363a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="a00015.html">tagWEBBY_CONNECTION</a>  <a class="el" href="a00015.html">WEBBY_CONNECTION</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga63d8c8d948713ccf37e92513e926d8b5"></a><!-- doxytag: member="webby.h::WEBBY_add_filter" ref="ga63d8c8d948713ccf37e92513e926d8b5" args="(WEBBY *server, size_t vhost_idx, HTTP_FILTER *filter)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WEBBY_add_filter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00013.html">WEBBY</a> *&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>vhost_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00006.html">HTTP_FILTER</a> *&#160;</td>
          <td class="paramname"><em>filter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00016_source.html#l00682">682</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> <a class="code" href="a00016.html#a8ee2b58fd7b17a9b1c7a79f14f27f9cb">DATA_SINK_FILTER_add_filter_to_vhost</a>(  server-&gt;<a class="code" href="a00013.html#af61d4b5e954a75d0d84bd45b10eb4940">sink_filter</a>, vhost_idx, filter );
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga6bcdf0577f33a202169d2df9fb2f782d"></a><!-- doxytag: member="webby.h::WEBBY_add_servlet" ref="ga6bcdf0577f33a202169d2df9fb2f782d" args="(WEBBY *server, HTTP_SERVLET *servlet)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WEBBY_add_servlet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00013.html">WEBBY</a> *&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00007.html">HTTP_SERVLET</a> *&#160;</td>
          <td class="paramname"><em>servlet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00016_source.html#l00687">687</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> <a class="code" href="a00016.html#a86c88fca79c44bdc017513e1c03dc45d">SERVLET_RUNNER_FILTER_add_servlet</a>( server-&gt;<a class="code" href="a00013.html#a9e287b121c1bc10c198ea22702046392">servlet_runner_filter</a>, servlet );
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga294920c6df652655a63a9cd5c368a09f"></a><!-- doxytag: member="webby.h::WEBBY_add_vhost" ref="ga294920c6df652655a63a9cd5c368a09f" args="(WEBBY *server, const char *host, int port_num, size_t *vhost_idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WEBBY_add_vhost </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00013.html">WEBBY</a> *&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>vhost_idx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00016_source.html#l00677">677</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> <a class="code" href="a00016.html#a06f7aefbd60aee0524ea808d92fe7ae2">DATA_SINK_FILTER_add_vhost</a>(  server-&gt;<a class="code" href="a00013.html#af61d4b5e954a75d0d84bd45b10eb4940">sink_filter</a>, host, port_num, vhost_idx );
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga000431a1b99da08f5711e788533ce0e2"></a><!-- doxytag: member="webby.h::WEBBY_connection_close" ref="ga000431a1b99da08f5711e788533ce0e2" args="(WEBBY_CONNECTION *connection)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void WEBBY_connection_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00015.html">WEBBY_CONNECTION</a> *&#160;</td>
          <td class="paramname"><em>connection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00016_source.html#l00836">836</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="a00005.html" title="structure is passed to filter function as argument.">FILTER_CONTEXT</a> *ctx;
  <span class="keywordtype">size_t</span> i;

  <span class="keywordflow">if</span> (!connection-&gt;<a class="code" href="a00015.html#a981014b88d204a0872d9943cd6dccb9a">filter_data</a>) {
    <span class="keywordflow">return</span>;
  }

  <span class="keywordflow">for</span>( ctx = connection-&gt;<a class="code" href="a00015.html#a981014b88d204a0872d9943cd6dccb9a">filter_data</a>, i = 0; i &lt; connection-&gt;num_filters ; ++ctx, ++i ) {
    ctx-&gt;<a class="code" href="a00005.html#ae9d9ee39035e778d3716187778febf40">filter</a>-&gt;<a class="code" href="a00006.html#a4e7c8380d5073fb0596d2ac4950c309f">on_connection_close</a>( ctx );
  }

  free( connection-&gt;<a class="code" href="a00015.html#a981014b88d204a0872d9943cd6dccb9a">filter_data</a> );
  connection-&gt;<a class="code" href="a00015.html#a981014b88d204a0872d9943cd6dccb9a">filter_data</a> = 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga80d94011f2e61e29fd041437c6dbdf17"></a><!-- doxytag: member="webby.h::WEBBY_connection_data_received" ref="ga80d94011f2e61e29fd041437c6dbdf17" args="(WEBBY_CONNECTION *connection)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WEBBY_connection_data_received </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00015.html">WEBBY_CONNECTION</a> *&#160;</td>
          <td class="paramname"><em>connection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00016_source.html#l00817">817</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  PARSER_STATUS st;
  
  st = HTTP_REQUEST_PARSER_process( &amp;connection-&gt;<a class="code" href="a00015.html#aa6ca489e0ea2b39fd9eda1f048da4f3b">request_parser</a>, &amp;connection-&gt;<a class="code" href="a00015.html#a0fd47114cffc5512054c650d2e931fee">request</a>, &amp;connection-&gt;<a class="code" href="a00015.html#abe2bc97a98ec04b90f63ace8b4ec22ee">in_buf</a> );
  <span class="keywordflow">switch</span>( st ) {
    <span class="keywordflow">case</span> PARSER_STATUS_ERROR:
      MLOG_INFO( <span class="stringliteral">&quot;Error during parsing of HTTP header&quot;</span> ); 
      <span class="keywordflow">return</span> -1;
    <span class="keywordflow">case</span> PARSER_STATUS_COMPLETED:
      HTTP_REQUEST_init( &amp;connection-&gt;<a class="code" href="a00015.html#a0fd47114cffc5512054c650d2e931fee">request</a> );
      BF_put_mode( &amp;connection-&gt;<a class="code" href="a00015.html#abe2bc97a98ec04b90f63ace8b4ec22ee">in_buf</a> );
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> PARSER_STATUS_NEED_MORE_DATA:
      <span class="keywordflow">break</span>;
  }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga24e0938463669691db76aa3a2aba418e"></a><!-- doxytag: member="webby.h::WEBBY_init" ref="ga24e0938463669691db76aa3a2aba418e" args="(WEBBY_CONFIG *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00013.html">WEBBY</a>* WEBBY_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00014.html">WEBBY_CONFIG</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00016_source.html#l00640">640</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{ 
  <a class="code" href="a00013.html">WEBBY</a> *ret;
  <a class="code" href="a00003.html">DATA_SINK_FILTER</a> *data_sink; 


  ret = (<a class="code" href="a00013.html">WEBBY</a> *) malloc( <span class="keyword">sizeof</span>( <a class="code" href="a00013.html">WEBBY</a> ) );
  <span class="keywordflow">if</span> (!ret) {
    <span class="keywordflow">return</span> 0;
  }
  ret-&gt;<a class="code" href="a00013.html#a96c8c9fff19088327c9ab5a3b7938ccb">cfg</a> = cfg;
 
 
  <span class="keywordflow">if</span> ( ARRAY_init( &amp;ret-&gt;<a class="code" href="a00013.html#a8f09ca4fc1921b78808787b500de0431">filters</a>, <span class="keyword">sizeof</span>( <a class="code" href="a00006.html" title="http filter definition">HTTP_FILTER</a> * ), 10 ) ) {
    <span class="keywordflow">return</span> 0;
  }
 
  <span class="comment">// first filter is sink filter - receives response data.</span>
  data_sink = <a class="code" href="a00016.html#ae2c4f415dacbb1559c04a802a1b1ea85">DATA_SINK_FILTER_init</a>( ret );
  <span class="keywordflow">if</span> (!data_sink) {
    <span class="keywordflow">return</span> 0;
  }
  ARRAY_push_back( &amp;ret-&gt;<a class="code" href="a00013.html#a8f09ca4fc1921b78808787b500de0431">filters</a>, &amp;data_sink, <span class="keyword">sizeof</span>( <span class="keywordtype">void</span> * ) );
  ret-&gt;<a class="code" href="a00013.html#af61d4b5e954a75d0d84bd45b10eb4940">sink_filter</a> = data_sink;

  ret-&gt;<a class="code" href="a00013.html#a9e287b121c1bc10c198ea22702046392">servlet_runner_filter</a> = <a class="code" href="a00016.html#ae2e8a500699c277f9d7461f75e15c517">SERVLET_RUNNER_FILTER_init</a>();
  <span class="keywordflow">if</span> (!ret-&gt;<a class="code" href="a00013.html#a9e287b121c1bc10c198ea22702046392">servlet_runner_filter</a>) {
    <span class="keywordflow">return</span> 0;
  }

  <span class="comment">// get the implementation object.</span>
  <span class="keywordflow">if</span> (<a class="code" href="a00025.html#gad65c49dee7d03e91bb0986c6cb9a2a63">WEBBY_impl_new</a>( ret, cfg, &amp;ret-&gt;<a class="code" href="a00013.html#ad0a59cc3f69711b8680cd0f230690a1e">impl</a> ) ) {
    <span class="keywordflow">return</span> 0;
  }
  <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga468f7c2a048c111edea76276865b0f11"></a><!-- doxytag: member="webby.h::WEBBY_new_connection" ref="ga468f7c2a048c111edea76276865b0f11" args="(WEBBY *server, void *implconndata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00015.html">WEBBY_CONNECTION</a>* WEBBY_new_connection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00013.html">WEBBY</a> *&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>implconndata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00016_source.html#l00755">755</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="a00015.html">WEBBY_CONNECTION</a> *ret = 0;
  <a class="code" href="a00005.html" title="structure is passed to filter function as argument.">FILTER_CONTEXT</a> *filter_data = 0;
  <span class="keywordtype">void</span> *buff = 0;
  <a class="code" href="a00004.html">DATA_SINK_FILTER_CONNECTION_CONTEXT</a> *sink_conn_ctx = 0;

  ret = (<a class="code" href="a00015.html">WEBBY_CONNECTION</a> *)  malloc( <span class="keyword">sizeof</span>(<a class="code" href="a00015.html">WEBBY_CONNECTION</a>) ); 
  <span class="keywordflow">if</span> (!ret) {
    <span class="keywordflow">goto</span> err;
  }

  buff = malloc( <a class="code" href="a00024.html#ga6216ff348213b42b05175fdda1b9398f">HTTP_PARSER_BUFFER_SIZE</a> );
  <span class="keywordflow">if</span> (!buff) {
    <span class="keywordflow">goto</span> err;
  }
  BF_init( &amp;ret-&gt;<a class="code" href="a00015.html#abe2bc97a98ec04b90f63ace8b4ec22ee">in_buf</a>, buff, <a class="code" href="a00024.html#ga6216ff348213b42b05175fdda1b9398f">HTTP_PARSER_BUFFER_SIZE</a>);
  
  filter_data = (<a class="code" href="a00005.html" title="structure is passed to filter function as argument.">FILTER_CONTEXT</a> *) malloc( server-&gt;<a class="code" href="a00013.html#aa4cb9fe479dec9c565bcd00cea19efac">filter_ctx_layout_size</a> );
  <span class="keywordflow">if</span> (!filter_data) {
    <span class="keywordflow">goto</span> err;
  }
  memcpy( filter_data, server-&gt;<a class="code" href="a00013.html#a56aa9a4e875902f86bd47750212b8086">filter_ctx_layout</a>, server-&gt;<a class="code" href="a00013.html#aa4cb9fe479dec9c565bcd00cea19efac">filter_ctx_layout_size</a> );
  ret-&gt;<a class="code" href="a00015.html#a432d09002a99af37052a7d40de7db432">num_filters</a> = ARRAY_size( &amp;server-&gt;<a class="code" href="a00013.html#a8f09ca4fc1921b78808787b500de0431">filters</a> );
  ret-&gt;<a class="code" href="a00015.html#a981014b88d204a0872d9943cd6dccb9a">filter_data</a> = filter_data;

  sink_conn_ctx = <a class="code" href="a00016.html#aa55c83fd7a299c138c538b20d50e9cb2">DATA_SINK_FILTER_CONNECTION_CONTEXT_init</a>( implconndata, &amp;ret-&gt;<a class="code" href="a00015.html#abe2bc97a98ec04b90f63ace8b4ec22ee">in_buf</a> ); 
  <span class="keywordflow">if</span> (! sink_conn_ctx) {   
    <span class="keywordflow">goto</span> err;
  }
  filter_data-&gt;<a class="code" href="a00005.html#a67ef86adee752b865e229fcf29b9ed90">connection_ctx</a> = sink_conn_ctx; 
 
 
  HTTP_REQUEST_PARSER_init( &amp;ret-&gt;<a class="code" href="a00015.html#aa6ca489e0ea2b39fd9eda1f048da4f3b">request_parser</a>,
                             <a class="code" href="a00016.html#a5d270f92a2a1d91a4497f7619892c421">http_header_parsed</a>,
                             <a class="code" href="a00016.html#a14b4ca97d7155383d1a5c97a27bb4944">http_on_message_data</a>,
                             <a class="code" href="a00016.html#ada6754658cfa8e6ac72c2f81497ea618">http_req_finished</a>,
                             filter_data);

 
  HTTP_REQUEST_init( &amp;ret-&gt;<a class="code" href="a00015.html#a0fd47114cffc5512054c650d2e931fee">request</a> );
 
  <span class="keywordflow">return</span> ret;

err:
  <span class="keywordflow">if</span> (filter_data) {
    free(filter_data);
  }
  <span class="keywordflow">if</span> (buff) {
    free(buff);
  }
  <span class="keywordflow">if</span> (ret) {
    free(ret);
  }
  <span class="keywordflow">if</span> (sink_conn_ctx) {
    <a class="code" href="a00016.html#a3213ef672b34bbb957fb0650ff5b2c85">DATA_SINK_FILTER_CONNECTION_CONTEXT_free</a>( implconndata );  
  }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="gad219e92389c7104756b0955e39f395a8"></a><!-- doxytag: member="webby.h::WEBBY_run" ref="gad219e92389c7104756b0955e39f395a8" args="(WEBBY *server)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WEBBY_run </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00013.html">WEBBY</a> *&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00016_source.html#l00693">693</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="a00005.html" title="structure is passed to filter function as argument.">FILTER_CONTEXT</a> *cur,*layout;
  <a class="code" href="a00006.html" title="http filter definition">HTTP_FILTER</a> **tmp;
  <span class="keywordtype">size_t</span> i;

  <span class="keywordflow">if</span> (<a class="code" href="a00024.html#ga63d8c8d948713ccf37e92513e926d8b5">WEBBY_add_filter</a>( server, 0, &amp;server-&gt;<a class="code" href="a00013.html#a9e287b121c1bc10c198ea22702046392">servlet_runner_filter</a>-&gt;<a class="code" href="a00011.html#a5b653e293e834b6d2a167533a0ff7b1c">base</a> ) ) {
    <span class="keywordflow">return</span> -1;
  }

  server-&gt;<a class="code" href="a00013.html#aa4cb9fe479dec9c565bcd00cea19efac">filter_ctx_layout_size</a> =  <span class="keyword">sizeof</span>( <a class="code" href="a00019.html#ga84c94eac8d6cfb5184937e3047eed77f" title="structure is passed to filter function as argument.">FILTER_CONTEXT</a> ) * ARRAY_size( &amp;server-&gt;<a class="code" href="a00013.html#a8f09ca4fc1921b78808787b500de0431">filters</a> ); 
  layout = (<a class="code" href="a00005.html" title="structure is passed to filter function as argument.">FILTER_CONTEXT</a> *) malloc(  server-&gt;<a class="code" href="a00013.html#aa4cb9fe479dec9c565bcd00cea19efac">filter_ctx_layout_size</a> );
  <span class="keywordflow">if</span> (! layout ) {
    <span class="keywordflow">return</span> -1;
  }
  server-&gt;<a class="code" href="a00013.html#a56aa9a4e875902f86bd47750212b8086">filter_ctx_layout</a> = layout;

  <span class="keywordflow">for</span>(i = 0, cur = (<a class="code" href="a00005.html" title="structure is passed to filter function as argument.">FILTER_CONTEXT</a> *) layout; i &lt; ARRAY_size( &amp;server-&gt;<a class="code" href="a00013.html#a8f09ca4fc1921b78808787b500de0431">filters</a> ); cur++, i++ ) {
     cur-&gt;<a class="code" href="a00005.html#a67ef86adee752b865e229fcf29b9ed90">connection_ctx</a> = 0;
     tmp = (<a class="code" href="a00006.html" title="http filter definition">HTTP_FILTER</a> **) ARRAY_at( &amp;server-&gt;<a class="code" href="a00013.html#a8f09ca4fc1921b78808787b500de0431">filters</a>, i );
 
     cur-&gt;<a class="code" href="a00005.html#ae9d9ee39035e778d3716187778febf40">filter</a> = *tmp;
     cur-&gt;<a class="code" href="a00005.html#aee0b58f4f4d1647af8f01e19a046cdf5">next_request_filter_idx</a> = cur-&gt;<a class="code" href="a00005.html#ae9d9ee39035e778d3716187778febf40">filter</a>-&gt;<a class="code" href="a00006.html#a2d64a2f372cb2f22ecc8fdfa53c0e3d7">next_request_filter_idx</a> - i;     
     cur-&gt;<a class="code" href="a00005.html#a6ca4c6974a625c100a13adfdb710acc4">next_response_filter_idx</a> = i - cur-&gt;<a class="code" href="a00005.html#ae9d9ee39035e778d3716187778febf40">filter</a>-&gt;<a class="code" href="a00006.html#a39dbd3ce3cfb65108dfcdc963edc8a85">next_response_filter_idx</a>;
  }
 
  <span class="keywordflow">return</span> <a class="code" href="a00025.html#ga303ba84a7bd2d3a7546babc2e4ee4082">WEBBY_impl_run</a>( server-&gt;<a class="code" href="a00013.html#ad0a59cc3f69711b8680cd0f230690a1e">impl</a> );
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga2fff1941b52b1eba9ded25079ecc3c6a"></a><!-- doxytag: member="webby.h::WEBBY_shutdown" ref="ga2fff1941b52b1eba9ded25079ecc3c6a" args="(WEBBY *server)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WEBBY_shutdown </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00013.html">WEBBY</a> *&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00016_source.html#l00722">722</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> <a class="code" href="a00025.html#gaafe98ebbe19ad95eeff61d5e3e843b26">WEBBY_impl_shutdown</a>( server-&gt;<a class="code" href="a00013.html#ad0a59cc3f69711b8680cd0f230690a1e">impl</a> ); 
}
</pre></div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Oct 25 2011 01:10:44 for WEBBY - the embedded web server with many faces / objects in plain C by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
