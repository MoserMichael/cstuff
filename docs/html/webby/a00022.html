<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WEBBY - the embedded web server with many faces / objects in plain C: HTTP_servlet_response</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">WEBBY - the embedded web server with many faces / objects in plain C&#160;<span id="projectnumber">Snapshot</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">HTTP_servlet_response</div>  </div>
<div class="ingroups"><a class="el" href="a00020.html">HTTP_SERVLET</a></div></div>
<div class="contents">

<p>represents the http response and includes methods to set response header and send the response body.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for HTTP_servlet_response:</div>
<div class="dyncontent">
<center><table><tr><td><img src="a00022.png" border="0" alt="" usemap="#a00022"/>
<map name="a00022" id="a00022">
<area shape="rect" id="node1" href="a00020.html" title="a servlet is a class that processes the http request and produces the http response" alt="" coords="5,5,131,35"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00009.html">tagHTTP_servlet_response</a></td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="a00009.html">tagHTTP_servlet_response</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00022.html#gab6262910a582a4aefa03806e8a9996ad">HTTP_servlet_response</a></td></tr>
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00022.html#gacac342618d827f10f920dd5d548967ef">HTTP_servlet_response_type</a> { <a class="el" href="a00022.html#ggacac342618d827f10f920dd5d548967efa9661c1d7c74d6eb76b75849ae30b33c6">RESPONSE_CONNECTION_CLOSE</a>, 
<a class="el" href="a00022.html#ggacac342618d827f10f920dd5d548967efa673a78de2e61f5d56936fc551684d6ee">RESPONSE_CONTENT_LENGTH</a>, 
<a class="el" href="a00022.html#ggacac342618d827f10f920dd5d548967efacc2acc83b0f66ab290f5f1fe6b940ef7">RESPONSE_CHUNKED</a>
 }</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00022.html#ga520d40a9fe92a4764f7800a957e74f35">HTTP_response_start</a> (<a class="el" href="a00009.html">HTTP_servlet_response</a> *resp, int status, const char *mime_type, <a class="el" href="a00022.html#gacac342618d827f10f920dd5d548967ef">HTTP_servlet_response_type</a> rtype, size_t length)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">initiate an HTTP response  <a href="#ga520d40a9fe92a4764f7800a957e74f35"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00022.html#gaed8f8e393fd1515d2f544f590c6b1867">HTTP_response_send</a> (<a class="el" href="a00009.html">HTTP_servlet_response</a> *resp, void *data, size_t size)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">send response data when sending RESPONSE_CONTENT_LENGTH or RESPONSE_CONNECTION_CLOSE responses  <a href="#gaed8f8e393fd1515d2f544f590c6b1867"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00022.html#gafcfed03fea048f6eab98c8b410bcc52c">HTTP_response_finish</a> (<a class="el" href="a00009.html">HTTP_servlet_response</a> *resp)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">finish sending of response  <a href="#gafcfed03fea048f6eab98c8b410bcc52c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">BF *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00022.html#gac35744637829527c41116ff45b67db37">HTTP_response_get_chunk_buffer</a> (<a class="el" href="a00009.html">HTTP_servlet_response</a> *resp, size_t chunk_size)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">returns buffer for sending chunks The buffer reserves enough space before start of buffer, in order to allow addition of chunk header before the sent daa  <a href="#gac35744637829527c41116ff45b67db37"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00022.html#gaba723292382fdd7307c5bd25a0370fe5">HTTP_response_write_chunk</a> (<a class="el" href="a00009.html">HTTP_servlet_response</a> *resp, BF *bf)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">send chunk from buffer The buffer must reserve enough space for the chunk header, before start of buffer  <a href="#gaba723292382fdd7307c5bd25a0370fe5"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>represents the http response and includes methods to set response header and send the response body. </p>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="gab6262910a582a4aefa03806e8a9996ad"></a><!-- doxytag: member="webby.h::HTTP_servlet_response" ref="gab6262910a582a4aefa03806e8a9996ad" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="a00009.html">tagHTTP_servlet_response</a>  <a class="el" href="a00009.html">HTTP_servlet_response</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="gacac342618d827f10f920dd5d548967ef"></a><!-- doxytag: member="webby.h::HTTP_servlet_response_type" ref="gacac342618d827f10f920dd5d548967ef" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00022.html#gacac342618d827f10f920dd5d548967ef">HTTP_servlet_response_type</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ggacac342618d827f10f920dd5d548967efa9661c1d7c74d6eb76b75849ae30b33c6"></a><!-- doxytag: member="RESPONSE_CONNECTION_CLOSE" ref="ggacac342618d827f10f920dd5d548967efa9661c1d7c74d6eb76b75849ae30b33c6" args="" -->RESPONSE_CONNECTION_CLOSE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggacac342618d827f10f920dd5d548967efa673a78de2e61f5d56936fc551684d6ee"></a><!-- doxytag: member="RESPONSE_CONTENT_LENGTH" ref="ggacac342618d827f10f920dd5d548967efa673a78de2e61f5d56936fc551684d6ee" args="" -->RESPONSE_CONTENT_LENGTH</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggacac342618d827f10f920dd5d548967efacc2acc83b0f66ab290f5f1fe6b940ef7"></a><!-- doxytag: member="RESPONSE_CHUNKED" ref="ggacac342618d827f10f920dd5d548967efacc2acc83b0f66ab290f5f1fe6b940ef7" args="" -->RESPONSE_CHUNKED</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="a00017_source.html#l00311">311</a> of file <a class="el" href="a00017_source.html">webby.h</a>.</p>
<div class="fragment"><pre class="fragment">             {
  <a class="code" href="a00022.html#ggacac342618d827f10f920dd5d548967efa9661c1d7c74d6eb76b75849ae30b33c6">RESPONSE_CONNECTION_CLOSE</a>,
  <a class="code" href="a00022.html#ggacac342618d827f10f920dd5d548967efa673a78de2e61f5d56936fc551684d6ee">RESPONSE_CONTENT_LENGTH</a>,
  <a class="code" href="a00022.html#ggacac342618d827f10f920dd5d548967efacc2acc83b0f66ab290f5f1fe6b940ef7">RESPONSE_CHUNKED</a>,
} <a class="code" href="a00022.html#gacac342618d827f10f920dd5d548967ef">HTTP_servlet_response_type</a>;
</pre></div>
</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gafcfed03fea048f6eab98c8b410bcc52c"></a><!-- doxytag: member="webby.h::HTTP_response_finish" ref="gafcfed03fea048f6eab98c8b410bcc52c" args="(HTTP_servlet_response *resp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HTTP_response_finish </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00009.html">HTTP_servlet_response</a> *&#160;</td>
          <td class="paramname"><em>resp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>finish sending of response </p>

<p>Definition at line <a class="el" href="a00016_source.html#l01003">1003</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="a00001.html">RDATA</a> rdata;

  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> &lt; 1 || resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> &gt; 2) {
    <span class="keywordflow">return</span> -1;
  }

  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> == 1) {
    <span class="keywordflow">if</span> (<a class="code" href="a00019.html#ga32fc8cf13fe1f891d2dcbb7e50f3b3a7" title="called by implementaiton of HTTP_FILTER_RESPONSE_HEADER filter callback, calls the next filter in the...">call_next_filter_response_header</a>( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>,  resp-&gt;<a class="code" href="a00009.html#a6807441c52560f55d6016a13404cd641">filter_context</a> )) {
      <span class="keywordflow">return</span> -1;
    }
  } 
 
 
  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>.base.flags &amp; HTTP_MESSAGE_FLAG_TRANSFER_CHUNKED) {
 
    rdata.<a class="code" href="a00001.html#a493098fc4beb27d6c267fe2bd649c2de">chunk</a>.<a class="code" href="a00001.html#a626fdc4af5978bfaca650f930d5eeeac">bf</a> = 0;
    rdata.<a class="code" href="a00001.html#a493098fc4beb27d6c267fe2bd649c2de">chunk</a>.<a class="code" href="a00001.html#a35c09a09a98b296c7ed641b70f8510eb">chunk_no</a> = ++resp-&gt;<a class="code" href="a00009.html#a83454d920f7218661b367f6cd9e3f3f3">chunk_no</a>;

    <span class="keywordflow">if</span> ( <a class="code" href="a00019.html#ga9f0f204b55f36f27c0fb680faf7e1305" title="called by implementaiton of HTTP_FILTER_RESPONSE_DATA filter callback, calls the next filter in the c...">call_next_filter_response_data</a> ( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>, 1, rdata, resp-&gt;<a class="code" href="a00009.html#a6807441c52560f55d6016a13404cd641">filter_context</a>  ) )  {
      <span class="keywordflow">return</span> -1;
    }

<span class="preprocessor">#if 0 </span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> == 1) {
      <span class="keywordflow">if</span> (<a class="code" href="a00019.html#ga9f0f204b55f36f27c0fb680faf7e1305" title="called by implementaiton of HTTP_FILTER_RESPONSE_DATA filter callback, calls the next filter in the c...">call_next_filter_response_data</a> ( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>, LAST_CHUNK, LAST_CHUNK_SIZE, resp-&gt;<a class="code" href="a00009.html#a6807441c52560f55d6016a13404cd641">filter_context</a>  )) {
        <span class="keywordflow">return</span> -1;
      }
    } <span class="keywordflow">else</span> {
      <span class="keywordflow">if</span> (<a class="code" href="a00019.html#ga9f0f204b55f36f27c0fb680faf7e1305" title="called by implementaiton of HTTP_FILTER_RESPONSE_DATA filter callback, calls the next filter in the c...">call_next_filter_response_data</a> ( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>, <a class="code" href="a00016.html#a7f05649123949a8e965870c97010f80e">LAST_CHUNK_NOT_FIRST</a>, <a class="code" href="a00016.html#aab62a761d0efd5b816b635391ca69f8b">LAST_CHUNK_NOT_FIRST_SIZE</a>, resp-&gt;<a class="code" href="a00009.html#a6807441c52560f55d6016a13404cd641">filter_context</a>  )) {
        <span class="keywordflow">return</span> -1;
      }
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>  }
  resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> = 3;
  
  <span class="keywordflow">return</span> <a class="code" href="a00019.html#ga4418cb00f29e45e927ca4b428358f288" title="called by implementaiton of HTTP_FILTER_RESPONSE_COMPLETED filter callback, calls the next filter in ...">call_next_filter_response_completed</a> ( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>, resp-&gt;<a class="code" href="a00009.html#a6807441c52560f55d6016a13404cd641">filter_context</a> );
}
</pre></div>
</div>
</div>
<a class="anchor" id="gac35744637829527c41116ff45b67db37"></a><!-- doxytag: member="webby.h::HTTP_response_get_chunk_buffer" ref="gac35744637829527c41116ff45b67db37" args="(HTTP_servlet_response *resp, size_t chunk_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BF* HTTP_response_get_chunk_buffer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00009.html">HTTP_servlet_response</a> *&#160;</td>
          <td class="paramname"><em>resp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>chunk_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>returns buffer for sending chunks The buffer reserves enough space before start of buffer, in order to allow addition of chunk header before the sent daa </p>

<p>Definition at line <a class="el" href="a00016_source.html#l00928">928</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">size_t</span> sz;
  <span class="keywordtype">void</span> *tmp;

  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#a6271be8a3acfe1eb86179de567a912f3">chunk_buf</a> != 0) {
    <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#abf0aa9810763fa4c8edd2d0fbfb1004a">chunk_buf_size</a> &lt; chunk_size ) {
      sz = chunk_size + <a class="code" href="a00016.html#a44427928ad20e54e7cef524635ff2bc0">RESERVED_FOR_CHUNK_HEADER_SIZE</a>; 
      tmp = realloc( resp-&gt;<a class="code" href="a00009.html#a6271be8a3acfe1eb86179de567a912f3">chunk_buf</a>, sz );
      <span class="keywordflow">if</span> (!tmp) {
        <span class="keywordflow">return</span> 0;
      }
      resp-&gt;<a class="code" href="a00009.html#a6271be8a3acfe1eb86179de567a912f3">chunk_buf</a> = tmp;
      resp-&gt;<a class="code" href="a00009.html#abf0aa9810763fa4c8edd2d0fbfb1004a">chunk_buf_size</a> = chunk_size;
    }
  } <span class="keywordflow">else</span> {
    sz = chunk_size + <a class="code" href="a00016.html#a44427928ad20e54e7cef524635ff2bc0">RESERVED_FOR_CHUNK_HEADER_SIZE</a>; 
    resp-&gt;<a class="code" href="a00009.html#a6271be8a3acfe1eb86179de567a912f3">chunk_buf</a> = malloc( sz ); 
    <span class="keywordflow">if</span> (!resp-&gt;<a class="code" href="a00009.html#a6271be8a3acfe1eb86179de567a912f3">chunk_buf</a>) {
      <span class="keywordflow">return</span> 0;
    }
    BF_init( &amp;resp-&gt;<a class="code" href="a00009.html#aec0c6f890c3a0f47f41c448d609a02aa">bf</a>, resp-&gt;<a class="code" href="a00009.html#a6271be8a3acfe1eb86179de567a912f3">chunk_buf</a>, sz );
    resp-&gt;<a class="code" href="a00009.html#abf0aa9810763fa4c8edd2d0fbfb1004a">chunk_buf_size</a> = chunk_size;
  } 
  
  BF_put_mode( &amp;resp-&gt;<a class="code" href="a00009.html#aec0c6f890c3a0f47f41c448d609a02aa">bf</a> );
  BF_set_start( &amp;resp-&gt;<a class="code" href="a00009.html#aec0c6f890c3a0f47f41c448d609a02aa">bf</a>, RESERVED_FOR_CHUNK_HEADER_SIZE ); 
  resp-&gt;<a class="code" href="a00009.html#aec0c6f890c3a0f47f41c448d609a02aa">bf</a>.end = resp-&gt;<a class="code" href="a00009.html#aec0c6f890c3a0f47f41c448d609a02aa">bf</a>.put_pos + chunk_size;
  
  <span class="keywordflow">return</span> &amp;resp-&gt;<a class="code" href="a00009.html#aec0c6f890c3a0f47f41c448d609a02aa">bf</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="gaed8f8e393fd1515d2f544f590c6b1867"></a><!-- doxytag: member="webby.h::HTTP_response_send" ref="gaed8f8e393fd1515d2f544f590c6b1867" args="(HTTP_servlet_response *resp, void *data, size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HTTP_response_send </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00009.html">HTTP_servlet_response</a> *&#160;</td>
          <td class="paramname"><em>resp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send response data when sending RESPONSE_CONTENT_LENGTH or RESPONSE_CONNECTION_CLOSE responses </p>
<p>Precondition: HTTP_response_start has been called. and response type is either RESPONSE_CONTENT_LENGTH or RESPONSE_CONNECTION_CLOSE </p>

<p>Definition at line <a class="el" href="a00016_source.html#l00892">892</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="a00001.html">RDATA</a> rdata;

  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> &lt; 1 || resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> &gt; 2) {
    <span class="keywordflow">return</span> -1;
  }

  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> == 1) {
    <span class="keywordflow">if</span> (<a class="code" href="a00019.html#ga32fc8cf13fe1f891d2dcbb7e50f3b3a7" title="called by implementaiton of HTTP_FILTER_RESPONSE_HEADER filter callback, calls the next filter in the...">call_next_filter_response_header</a>( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>,  resp-&gt;<a class="code" href="a00009.html#a6807441c52560f55d6016a13404cd641">filter_context</a> )) {
      <span class="keywordflow">return</span> -1;
    }
    resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> = 2;
  }

  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>.base.flags &amp; HTTP_MESSAGE_FLAG_TRANSFER_CHUNKED ) {
    <span class="keywordflow">return</span> -1;
  }

  <span class="comment">// check that not sending more data than allowed by set value of Content-Length header.</span>
  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#a03492116d30e34715724cc33f5fe52e5">data_sent</a> != (<span class="keywordtype">size_t</span>) -1) {
    <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#a03492116d30e34715724cc33f5fe52e5">data_sent</a> &lt; size ) {
      <span class="keywordflow">return</span> -1;
    }
    resp-&gt;<a class="code" href="a00009.html#a03492116d30e34715724cc33f5fe52e5">data_sent</a> -= size;
  }

  rdata.<a class="code" href="a00001.html#a47df03eb99f239c14e83ff9527b8a97b">no_chunk</a>.<a class="code" href="a00001.html#a3ff50d24d705be48dd99ef32cfa0ad34">data</a> = data;
  rdata.<a class="code" href="a00001.html#a47df03eb99f239c14e83ff9527b8a97b">no_chunk</a>.<a class="code" href="a00001.html#a5025856b2bd77112fef2041fd64b33e9">data_size</a> = size;

  <span class="keywordflow">return</span> <a class="code" href="a00019.html#ga9f0f204b55f36f27c0fb680faf7e1305" title="called by implementaiton of HTTP_FILTER_RESPONSE_DATA filter callback, calls the next filter in the c...">call_next_filter_response_data</a> ( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>, 0, rdata, resp-&gt;<a class="code" href="a00009.html#a6807441c52560f55d6016a13404cd641">filter_context</a> );
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga520d40a9fe92a4764f7800a957e74f35"></a><!-- doxytag: member="webby.h::HTTP_response_start" ref="ga520d40a9fe92a4764f7800a957e74f35" args="(HTTP_servlet_response *resp, int status, const char *mime_type, HTTP_servlet_response_type rtype, size_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HTTP_response_start </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00009.html">HTTP_servlet_response</a> *&#160;</td>
          <td class="paramname"><em>resp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mime_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00022.html#gacac342618d827f10f920dd5d548967ef">HTTP_servlet_response_type</a>&#160;</td>
          <td class="paramname"><em>rtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initiate an HTTP response </p>

<p>Definition at line <a class="el" href="a00016_source.html#l00855">855</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> !=0) {
    <span class="keywordflow">return</span> -1;
  }
  resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>.status_code = status;
  <span class="keywordflow">if</span> (mime_type) {
    HTTP_MESSAGE_add_header( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>.base, <span class="stringliteral">&quot;Content-Type&quot;</span>, mime_type );
  }

  <span class="keywordflow">if</span> ( ! HTTP_REQUEST_is_persistent( resp-&gt;<a class="code" href="a00009.html#acfe932960b95d037da48c87fc27beb79">request</a> ) ) {
    rtype = <a class="code" href="a00022.html#ggacac342618d827f10f920dd5d548967efa9661c1d7c74d6eb76b75849ae30b33c6">RESPONSE_CONNECTION_CLOSE</a>;
  }
 
  <span class="keywordflow">switch</span>(rtype) {
   <span class="keywordflow">case</span> <a class="code" href="a00022.html#ggacac342618d827f10f920dd5d548967efa9661c1d7c74d6eb76b75849ae30b33c6">RESPONSE_CONNECTION_CLOSE</a>:
     resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>.base.flags = HTTP_MESSAGE_FLAG_CONNECTION_CLOSE;  
     resp-&gt;<a class="code" href="a00009.html#a03492116d30e34715724cc33f5fe52e5">data_sent</a> = (size_t) -1;
     <span class="keywordflow">break</span>;
   <span class="keywordflow">case</span> <a class="code" href="a00022.html#ggacac342618d827f10f920dd5d548967efa673a78de2e61f5d56936fc551684d6ee">RESPONSE_CONTENT_LENGTH</a>:
     HTTP_MESSAGE_set_content_length( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>.base, length );
     resp-&gt;<a class="code" href="a00009.html#a03492116d30e34715724cc33f5fe52e5">data_sent</a> = length;
     <span class="keywordflow">break</span>;
   <span class="keywordflow">case</span> <a class="code" href="a00022.html#ggacac342618d827f10f920dd5d548967efacc2acc83b0f66ab290f5f1fe6b940ef7">RESPONSE_CHUNKED</a>:
     resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>.base.flags = HTTP_MESSAGE_FLAG_TRANSFER_CHUNKED;  
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>     <span class="keywordflow">if</span> (HTTP_MESSAGE_add_header( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>.base, <span class="stringliteral">&quot;Transfer-Encoding&quot;</span> , <span class="stringliteral">&quot;chunked&quot;</span> )) {
       <span class="keywordflow">return</span> -1;
     }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>     <span class="keywordflow">break</span>;
  }

  resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> = 1;
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="gaba723292382fdd7307c5bd25a0370fe5"></a><!-- doxytag: member="webby.h::HTTP_response_write_chunk" ref="gaba723292382fdd7307c5bd25a0370fe5" args="(HTTP_servlet_response *resp, BF *bf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HTTP_response_write_chunk </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00009.html">HTTP_servlet_response</a> *&#160;</td>
          <td class="paramname"><em>resp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BF *&#160;</td>
          <td class="paramname"><em>bf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send chunk from buffer The buffer must reserve enough space for the chunk header, before start of buffer </p>
<p>Precondition: HTTP_response_start has been called, and response type is RESPONSE_CHUNKED </p>

<p>Definition at line <a class="el" href="a00016_source.html#l00960">960</a> of file <a class="el" href="a00016_source.html">webby.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="a00001.html">RDATA</a> rdata;

  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> &lt; 1 || resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> &gt; 2) {
    <span class="keywordflow">return</span> -1;
  }
  <span class="keywordflow">if</span> ( (resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>.base.flags &amp; (HTTP_MESSAGE_FLAG_TRANSFER_CHUNKED | HTTP_MESSAGE_FLAG_CONNECTION_CLOSE)  ) == 0) {
    <span class="keywordflow">return</span> -1;
  }

  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> == 1) {
    <span class="keywordflow">if</span> (<a class="code" href="a00019.html#ga32fc8cf13fe1f891d2dcbb7e50f3b3a7" title="called by implementaiton of HTTP_FILTER_RESPONSE_HEADER filter callback, calls the next filter in the...">call_next_filter_response_header</a>( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>,  resp-&gt;<a class="code" href="a00009.html#a6807441c52560f55d6016a13404cd641">filter_context</a> )) {
      <span class="keywordflow">return</span> -1;
    }
    resp-&gt;<a class="code" href="a00009.html#a1e5ec22738cccb12b9b3bdcdd431f168">state</a> = 2;
  } <span class="keywordflow">else</span> {
    ++ resp-&gt;<a class="code" href="a00009.html#a83454d920f7218661b367f6cd9e3f3f3">chunk_no</a>;
  }

  <span class="keywordflow">if</span> ( resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>.base.flags &amp; HTTP_MESSAGE_FLAG_CONNECTION_CLOSE ) { 
    rdata.<a class="code" href="a00001.html#a47df03eb99f239c14e83ff9527b8a97b">no_chunk</a>.<a class="code" href="a00001.html#a3ff50d24d705be48dd99ef32cfa0ad34">data</a> = bf-&gt;get_pos;
    rdata.<a class="code" href="a00001.html#a47df03eb99f239c14e83ff9527b8a97b">no_chunk</a>.<a class="code" href="a00001.html#a5025856b2bd77112fef2041fd64b33e9">data_size</a> = BF_get_size( bf );  

    <span class="keywordflow">return</span> <a class="code" href="a00019.html#ga9f0f204b55f36f27c0fb680faf7e1305" title="called by implementaiton of HTTP_FILTER_RESPONSE_DATA filter callback, calls the next filter in the c...">call_next_filter_response_data</a> ( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>, 0, rdata, resp-&gt;<a class="code" href="a00009.html#a6807441c52560f55d6016a13404cd641">filter_context</a>  );
  }

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (first_chunk) {
    len = snprintf( chunk_header, <span class="keyword">sizeof</span>( chunk_header ),  <span class="stringliteral">&quot;%x\r\n&quot;</span>, BF_get_size(bf) );
  } <span class="keywordflow">else</span> {
    len = snprintf( chunk_header, <span class="keyword">sizeof</span>( chunk_header ),  <span class="stringliteral">&quot;\r\n%x\r\n&quot;</span>, BF_get_size(bf) );
  }

<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  rdata.<a class="code" href="a00001.html#a493098fc4beb27d6c267fe2bd649c2de">chunk</a>.<a class="code" href="a00001.html#a626fdc4af5978bfaca650f930d5eeeac">bf</a> = bf;
  rdata.<a class="code" href="a00001.html#a493098fc4beb27d6c267fe2bd649c2de">chunk</a>.<a class="code" href="a00001.html#a35c09a09a98b296c7ed641b70f8510eb">chunk_no</a> = resp-&gt;<a class="code" href="a00009.html#a83454d920f7218661b367f6cd9e3f3f3">chunk_no</a>;


  <span class="keywordflow">return</span> <a class="code" href="a00019.html#ga9f0f204b55f36f27c0fb680faf7e1305" title="called by implementaiton of HTTP_FILTER_RESPONSE_DATA filter callback, calls the next filter in the c...">call_next_filter_response_data</a> ( &amp;resp-&gt;<a class="code" href="a00009.html#aa55ce344b1ed261af07279c567b08d7b">response</a>, 1, rdata, resp-&gt;<a class="code" href="a00009.html#a6807441c52560f55d6016a13404cd641">filter_context</a>  );
}
</pre></div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Oct 25 2011 01:17:17 for WEBBY - the embedded web server with many faces / objects in plain C by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
