<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>HTTP Parser and message builder / objects in plain C: parser of http requests</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HTTP Parser and message builder / objects in plain C&#160;<span id="projectnumber">Snapshot</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">parser of http requests</div>  </div>
</div>
<div class="contents">

<p>parser of http requests  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html">tagHTTP_REQUEST_PARSER</a></td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="a00006.html">tagHTTP_REQUEST_PARSER</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#ga21137341221e8a3b92b3a73253d2fb08">HTTP_REQUEST_PARSER</a></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#gaf0a986ea0582bfc4b011d2ac61aac9ca">HTTP_REQUEST_PARSER_init</a> (<a class="el" href="a00006.html">HTTP_REQUEST_PARSER</a> *parser, <a class="el" href="a00025.html#ga50bf360c3d97280b2666c1809a506e2a">HTTP_REQ_HEADER_PARSED</a> header_parsed, <a class="el" href="a00025.html#gaa24d67ab42bb7b2da8c617b1b21b54a9">HTTP_REQ_MESSAGE_BODY_DATA</a> on_message_body_data, <a class="el" href="a00025.html#gaaad3a1f235bb76629fb76266f229a6bc">HTTP_REQ_FINISHED</a> on_request_finished, void *ctx)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">initialise request parser object  <a href="#gaf0a986ea0582bfc4b011d2ac61aac9ca"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="a00025.html#gace21a5a69d5e05c5c42d4861f37a49c4">PARSER_STATUS</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html#ga84afcea80bc8b534b3eee27594d2afbd">HTTP_REQUEST_PARSER_process</a> (<a class="el" href="a00006.html">HTTP_REQUEST_PARSER</a> *parser, <a class="el" href="a00005.html">HTTP_REQUEST</a> *request, BF *data)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">parse a http request  <a href="#ga84afcea80bc8b534b3eee27594d2afbd"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>parser of http requests </p>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="ga21137341221e8a3b92b3a73253d2fb08"></a><!-- doxytag: member="http.h::HTTP_REQUEST_PARSER" ref="ga21137341221e8a3b92b3a73253d2fb08" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="a00006.html">tagHTTP_REQUEST_PARSER</a>  <a class="el" href="a00006.html">HTTP_REQUEST_PARSER</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gaf0a986ea0582bfc4b011d2ac61aac9ca"></a><!-- doxytag: member="http.h::HTTP_REQUEST_PARSER_init" ref="gaf0a986ea0582bfc4b011d2ac61aac9ca" args="(HTTP_REQUEST_PARSER *parser, HTTP_REQ_HEADER_PARSED header_parsed, HTTP_REQ_MESSAGE_BODY_DATA on_message_body_data, HTTP_REQ_FINISHED on_request_finished, void *ctx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HTTP_REQUEST_PARSER_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00006.html">HTTP_REQUEST_PARSER</a> *&#160;</td>
          <td class="paramname"><em>parser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00025.html#ga50bf360c3d97280b2666c1809a506e2a">HTTP_REQ_HEADER_PARSED</a>&#160;</td>
          <td class="paramname"><em>header_parsed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00025.html#gaa24d67ab42bb7b2da8c617b1b21b54a9">HTTP_REQ_MESSAGE_BODY_DATA</a>&#160;</td>
          <td class="paramname"><em>on_message_body_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00025.html#gaaad3a1f235bb76629fb76266f229a6bc">HTTP_REQ_FINISHED</a>&#160;</td>
          <td class="paramname"><em>on_request_finished</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initialise request parser object </p>

<p>Definition at line <a class="el" href="a00016_source.html#l00646">646</a> of file <a class="el" href="a00016_source.html">http.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  parser-&gt;<a class="code" href="a00006.html#ae225e688d56dd152ac4ffa8c36d38770">ctx</a> = ctx;
  parser-&gt;<a class="code" href="a00006.html#add769d72f649da147653730b07d10865">ev_header</a>  = header_parsed;
  parser-&gt;<a class="code" href="a00006.html#a23d5b42db28063c39c624b2ffcb51d0d">ev_body</a> = on_message_body_data;
  parser-&gt;<a class="code" href="a00006.html#ae45a5d00172db9563679af5fb3f6f808">ev_finish</a> = on_request_finished;
     
  <span class="keywordflow">if</span> (<a class="code" href="a00025.html#gaa5370897809bd47280b44b5fa679d2d3">HTTP_PARSER_init</a>( &amp;parser-&gt;<a class="code" href="a00006.html#aabce9198ce8df4a2bdda071cc49d2f98">base</a> )) {
    <span class="keywordflow">return</span> -1;
  }
 
  <span class="keywordflow">if</span> (<a class="code" href="a00015.html#a8839eee7a29fdaecb57faddfea66620d">init_parsers_request_header</a>( &amp;parser-&gt;<a class="code" href="a00006.html#aabce9198ce8df4a2bdda071cc49d2f98">base</a> ) ||
      <a class="code" href="a00015.html#aed9d9e4b3924953f553c81d8767b9670">init_parsers_general_header</a>( &amp;parser-&gt;<a class="code" href="a00006.html#aabce9198ce8df4a2bdda071cc49d2f98">base</a> ) ) {
    <span class="keywordflow">return</span> -1;
  }
 
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga84afcea80bc8b534b3eee27594d2afbd"></a><!-- doxytag: member="http.h::HTTP_REQUEST_PARSER_process" ref="ga84afcea80bc8b534b3eee27594d2afbd" args="(HTTP_REQUEST_PARSER *parser, HTTP_REQUEST *request, BF *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00025.html#gace21a5a69d5e05c5c42d4861f37a49c4">PARSER_STATUS</a> HTTP_REQUEST_PARSER_process </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00006.html">HTTP_REQUEST_PARSER</a> *&#160;</td>
          <td class="paramname"><em>parser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00005.html">HTTP_REQUEST</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BF *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>parse a http request </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 - done parsing, 1 need more data, -1 error occured. </dd></dl>

<p>Definition at line <a class="el" href="a00016_source.html#l00671">671</a> of file <a class="el" href="a00016_source.html">http.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> rt, eof_header;


  <span class="keywordflow">while</span>(1) {
   <span class="keywordflow">switch</span>( parser-&gt;<a class="code" href="a00006.html#aabce9198ce8df4a2bdda071cc49d2f98">base</a>.<a class="code" href="a00004.html#ac18acb9d3ec3879248cee7e1f448a81a">state</a> ) {
    <span class="keywordflow">case</span> <a class="code" href="a00025.html#gga8399cf0558ed67328d5221a21a155cd2a4b3e4ef1a704d0e1c16ad482d0bb38aa">HTTP_STATE_PARSING_REQUEST_LINE</a>:
      rt = <a class="code" href="a00016.html#a6dbb89ef5afb7d9640fad8c33c6cda21">parse_request_line</a>( request, bf );
      <span class="keywordflow">if</span> (rt != 0) {
       <span class="keywordflow">goto</span> req_do_return;
      }
      parser-&gt;<a class="code" href="a00006.html#aabce9198ce8df4a2bdda071cc49d2f98">base</a>.<a class="code" href="a00004.html#ac18acb9d3ec3879248cee7e1f448a81a">state</a> = <a class="code" href="a00025.html#gga8399cf0558ed67328d5221a21a155cd2ab6734bc6ccbc93928357db1f17dd9e97">HTTP_STATE_PARSING_HEADERS</a>; <span class="comment">// </span>
   <span class="comment">//break; - fall through</span>


    <span class="keywordflow">case</span> <a class="code" href="a00025.html#gga8399cf0558ed67328d5221a21a155cd2ab6734bc6ccbc93928357db1f17dd9e97">HTTP_STATE_PARSING_HEADERS</a>:
      rt = <a class="code" href="a00025.html#gaa737a4c11979880764fb8031d5dfc488" title="dispatch parsing of one http header">HTTP_parse_header_line</a>( (<a class="code" href="a00004.html">HTTP_PARSER</a> *) parser, (<a class="code" href="a00003.html">HTTP_MESSAGE</a> *) request, bf, &amp;eof_header );
      <span class="keywordflow">if</span> (rt != 0) {
        <span class="keywordflow">goto</span> req_do_return;
      }

      <span class="keywordflow">if</span> (eof_header) {
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>          <span class="comment">// this check will we done by web server; if no host header then send back HTTP status 400.</span>

          <span class="comment">// if http 1.1 then host header is a must. no host header is an error.</span>
          <span class="keywordflow">if</span> (request-&gt;<a class="code" href="a00005.html#a6225f594931f6ff84063b1affca2f582">version</a> ==  <a class="code" href="a00024.html#gga92ff2f79ea14e92657972a36d58883a1af1a34119b438038bc609a273f9bc08c6">HTTP_VERSION_1_1</a> &amp;&amp;
              !request-&gt;<a class="code" href="a00005.html#a013e5373d35354986ff53b318452edf5">has_host_header</a>) {
            <span class="keywordflow">return</span> <a class="code" href="a00025.html#ggace21a5a69d5e05c5c42d4861f37a49c4a4bd96b2bfcb709eb5caf0ef934cc921d">PARSER_STATUS_ERROR</a>;  
          }
<span class="preprocessor">#endif    </span>
<span class="preprocessor"></span>
          <span class="comment">// eof parsing http header.</span>
          <span class="keywordflow">if</span> (parser-&gt;ev_header( request, parser-&gt;ctx )) {
            <span class="keywordflow">return</span> <a class="code" href="a00025.html#ggace21a5a69d5e05c5c42d4861f37a49c4a4bd96b2bfcb709eb5caf0ef934cc921d">PARSER_STATUS_ERROR</a>; 
          }
          BF_compact(bf);

          <span class="keywordflow">if</span> (request-&gt;<a class="code" href="a00005.html#a66fc31b502c5ab5699c8f8263991f69b">base</a>.<a class="code" href="a00003.html#a7aa368f6b6bd57c4503b088bd60f6168">flags</a> &amp; <a class="code" href="a00017.html#ac8a5bb01ca6fedc97a5a5377397f5a84">HTTP_MESSAGE_FLAG_TRANSFER_CHUNKED</a>) {
             <a class="code" href="a00025.html#ga0cfd781757cd6db4812087df78424fda" title="start parsing chunked data">HTTP_PARSER_chunked_data_init</a>( &amp;parser-&gt;base );
             <span class="keywordflow">continue</span>;  
          }

 
          <span class="keywordflow">if</span> (request-&gt;<a class="code" href="a00005.html#a66fc31b502c5ab5699c8f8263991f69b">base</a>.<a class="code" href="a00003.html#a7aa368f6b6bd57c4503b088bd60f6168">flags</a> &amp; <a class="code" href="a00017.html#a091dd3c50642a1632d85fe2d552d4a69">HTTP_MESSAGE_FLAG_HAS_CONTENT_LENGTH</a>) {
             <a class="code" href="a00025.html#ga8b4ee246e968497579a9d9d194a92571" title="start parsing content length message body">HTTP_PARSER_content_length_init</a>( &amp;parser-&gt;base, &amp;request-&gt;<a class="code" href="a00005.html#a66fc31b502c5ab5699c8f8263991f69b">base</a> );
             <span class="keywordflow">continue</span>;  
          }

next_request:
          <span class="keywordflow">if</span> (parser-&gt;ev_finish( request, parser-&gt;ctx )) {
            <span class="keywordflow">return</span> <a class="code" href="a00025.html#ggace21a5a69d5e05c5c42d4861f37a49c4a4bd96b2bfcb709eb5caf0ef934cc921d">PARSER_STATUS_ERROR</a>;
          }
          parser-&gt;base.<a class="code" href="a00004.html#ac18acb9d3ec3879248cee7e1f448a81a">state</a> = <a class="code" href="a00025.html#gga8399cf0558ed67328d5221a21a155cd2a4b3e4ef1a704d0e1c16ad482d0bb38aa">HTTP_STATE_PARSING_REQUEST_LINE</a>; 
          <a class="code" href="a00024.html#ga4ab326e8402a38ac166e2f90a50d91ec">HTTP_REQUEST_free</a>(request);  
          <span class="keywordflow">return</span> <a class="code" href="a00025.html#ggace21a5a69d5e05c5c42d4861f37a49c4a25ead330805092a1babdf67ca0f018c6">PARSER_STATUS_COMPLETED</a>;
      }
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="a00025.html#gga8399cf0558ed67328d5221a21a155cd2ade8a7e55f2fe126b0bddf7780bff40a0">HTTP_STATE_PARSING_BODY_CONTENT_LENGTH</a>:
      rt = <a class="code" href="a00025.html#ga34a73b6fe4c943ce1831c8b93c7fb426" title="consume content length message body.">HTTP_PARSER_content_length_process</a>( 
                &amp;parser-&gt;base, bf, 
                (<a class="code" href="a00025.html#gaccc79fd2431c99ecd68a090469da5d40">HTTP_PROCESS_MSG_DATA</a>) parser-&gt;ev_body, 
                &amp;request-&gt;<a class="code" href="a00005.html#a66fc31b502c5ab5699c8f8263991f69b">base</a>, parser-&gt;ctx);
      <span class="keywordflow">if</span> (rt != 0) {
        <span class="keywordflow">goto</span> req_do_return;
      }
      <span class="keywordflow">goto</span> next_request;

    <span class="keywordflow">default</span>: <span class="comment">// remaining states deal with chunks</span>
      rt =  <a class="code" href="a00025.html#gac93ea444be8644a86692ae98ec0b86c6" title="finish parsind chunked content data.">HTTP_PARSER_chunked_data_process</a>( 
                &amp;parser-&gt;base, bf, 
                (<a class="code" href="a00025.html#gaccc79fd2431c99ecd68a090469da5d40">HTTP_PROCESS_MSG_DATA</a>) parser-&gt;ev_body, 
                &amp;request-&gt;<a class="code" href="a00005.html#a66fc31b502c5ab5699c8f8263991f69b">base</a>, parser-&gt;ctx);

      <span class="keywordflow">if</span> (rt != 0) {
        <span class="keywordflow">goto</span> req_do_return;
      }
      <span class="keywordflow">goto</span> next_request;
    }
  }

req_do_return:
  <span class="keywordflow">if</span> (rt ==  <a class="code" href="a00025.html#ggace21a5a69d5e05c5c42d4861f37a49c4af41f996b5530777e9711a51a4050bb9b">PARSER_STATUS_NEED_MORE_DATA</a>) {
    BF_compact( bf );
  }
  <span class="keywordflow">return</span> rt;
}
</pre></div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Oct 25 2011 01:10:43 for HTTP Parser and message builder / objects in plain C by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
