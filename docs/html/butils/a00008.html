<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Simple utilities sink - stuff that doesn&#39;t fit anywhere else / objects in plain C: ERRORP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Simple utilities sink - stuff that doesn't fit anywhere else / objects in plain C&#160;<span id="projectnumber">Snapshot</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ERRORP</div>  </div>
</div>
<div class="contents">

<p>error logging with stack trace (not the symbols, just the addresses).  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#ga766648cd1050284e3170e1122e776b4f">errorp_open_file</a> (const char *file)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#ga6911b37ee103e7778baa57f3ef4e1f58">errorp_close_file</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#gaeb8c47ac00ab256e031f9897e3cc4be4">errorp</a> (int rval, const char *fmt,...)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>error logging with stack trace (not the symbols, just the addresses). </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gaeb8c47ac00ab256e031f9897e3cc4be4"></a><!-- doxytag: member="errorp.h::errorp" ref="gaeb8c47ac00ab256e031f9897e3cc4be4" args="(int rval, const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void errorp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00002_source.html#l00052">52</a> of file <a class="el" href="a00002_source.html">errorp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">char</span> buff[ 1024 ];
  <span class="keywordtype">char</span> *p, *eof;
  va_list ap;
  <span class="keywordtype">int</span> len, n;
 
<span class="preprocessor">#if __linux__</span>
<span class="preprocessor"></span>  <span class="keywordtype">void</span> *sframes[ <a class="code" href="a00002.html#afa5bb6221801445761a1f1c41101284f">STACK_FRAMES</a> + 1 ];
  <span class="keywordtype">int</span> nframes, i;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  p = buff;
  eof = p + <span class="keyword">sizeof</span>( buff );

  strcpy( p, <a class="code" href="a00002.html#a2983b695e827265a5b46ab9405446e36">ERROR_TOKEN</a> );
  p += strlen( <a class="code" href="a00002.html#a2983b695e827265a5b46ab9405446e36">ERROR_TOKEN</a> );


  va_start( ap, fmt );
  len =  vsnprintf( p, eof - p - 1, fmt, ap );
  va_end( ap );
  p += len;

  n = snprintf(p, eof - p - 1, <span class="stringliteral">&quot;. returns %d errno %d\n&quot;</span>, rval, errno );
  p += n;
   
  write( <a class="code" href="a00002.html#aeabf08bbf5921db02b75ca07b49ee34a">FD_OUT</a> , buff , p - buff );

<span class="preprocessor">#if __linux__</span>
<span class="preprocessor"></span>  nframes = backtrace( sframes, <a class="code" href="a00002.html#afa5bb6221801445761a1f1c41101284f">STACK_FRAMES</a> + 1); \
  write( <a class="code" href="a00002.html#aeabf08bbf5921db02b75ca07b49ee34a">FD_OUT</a>, <a class="code" href="a00002.html#a1763c9556bd80b7806528729edc98a05">STACK_START</a>, strlen( <a class="code" href="a00002.html#a1763c9556bd80b7806528729edc98a05">STACK_START</a> ) );
  
  nframes =  backtrace( sframes, <a class="code" href="a00002.html#afa5bb6221801445761a1f1c41101284f">STACK_FRAMES</a> );
  <span class="keywordflow">for</span> (i=0; i&lt;nframes; i++) {
    snprintf( buff, <span class="keyword">sizeof</span>(buff),  <span class="stringliteral">&quot;frame %d ip: %p\n&quot;</span>, i, sframes[ i ]);
    write( <a class="code" href="a00002.html#aeabf08bbf5921db02b75ca07b49ee34a">FD_OUT</a> , buff, strlen( buff ) );
  }

  dump_modules();
  write( <a class="code" href="a00002.html#aeabf08bbf5921db02b75ca07b49ee34a">FD_OUT</a>, <a class="code" href="a00002.html#ae6fd4cb094a69a8f1f658790e4b4d382">STACK_EOF</a>, strlen( <a class="code" href="a00002.html#ae6fd4cb094a69a8f1f658790e4b4d382">STACK_EOF</a> ) );
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="ga6911b37ee103e7778baa57f3ef4e1f58"></a><!-- doxytag: member="errorp.h::errorp_close_file" ref="ga6911b37ee103e7778baa57f3ef4e1f58" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void errorp_close_file </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00002_source.html#l00043">43</a> of file <a class="el" href="a00002_source.html">errorp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (<a class="code" href="a00002.html#a5ef1a826bfb22c8590a5773ba030fdd7">FD_ASSIGNED</a> != 1) {
    close( <a class="code" href="a00002.html#aeabf08bbf5921db02b75ca07b49ee34a">FD_OUT</a> );
    <a class="code" href="a00002.html#aeabf08bbf5921db02b75ca07b49ee34a">FD_OUT</a> = 2;
    <a class="code" href="a00002.html#a5ef1a826bfb22c8590a5773ba030fdd7">FD_ASSIGNED</a> = 0;
  }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga766648cd1050284e3170e1122e776b4f"></a><!-- doxytag: member="errorp.h::errorp_open_file" ref="ga766648cd1050284e3170e1122e776b4f" args="(const char *file)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int errorp_open_file </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00002_source.html#l00031">31</a> of file <a class="el" href="a00002_source.html">errorp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> fd;

  fd = open( file , O_CREAT | O_RDWR, S_IWUSR  | S_IRUSR );
  <span class="keywordflow">if</span> (fd != -1) {
    <a class="code" href="a00002.html#aeabf08bbf5921db02b75ca07b49ee34a">FD_OUT</a> = fd;
    <a class="code" href="a00002.html#a5ef1a826bfb22c8590a5773ba030fdd7">FD_ASSIGNED</a> = 1;
  }
  <span class="keywordflow">return</span> fd;
}
</pre></div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Sep 1 2011 21:07:15 for Simple utilities sink - stuff that doesn't fit anywhere else / objects in plain C by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
