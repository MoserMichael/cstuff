<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Simple data structures / objects in plain C: bhash.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Simple data structures / objects in plain C&#160;<span id="projectnumber">Snapshot</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">bhash.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="a00016_source.html">cutils/bhash.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00032_source.html">cutils/util.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00022_source.html">cutils/hashfunction.h</a>&gt;</code><br/>
</div>
<p><a href="a00015_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00015.html#acb4c58835714882f70736b2c45188ff4">ADJUST_HASH</a>(hash, buckets)&#160;&#160;&#160;((hash) &amp; ((buckets) - 1))</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00015.html#a73ce0ca18399c5db0bac0491aeadba8d">HASH_init</a> (<a class="el" href="a00003.html">HASH</a> *hash, size_t buckets, int ismultimap, <a class="el" href="a00016.html#af9eab147ddd898a2d7fb376e1f8753a3">HASH_COMPARE_KEY</a> compare_key, <a class="el" href="a00016.html#a11718c21601b9ee597d31cb7e720c260">HASH_FUNCTION</a> hash_func)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Object constructor; initialise the hash that allows one entry for a given key.  <a href="#a73ce0ca18399c5db0bac0491aeadba8d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00015.html#acef4d862b25db1563ce621265299fb2e">HASH_resize</a> (<a class="el" href="a00003.html">HASH</a> *hash, size_t buckets)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">resize the hash table  <a href="#acef4d862b25db1563ce621265299fb2e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="a00004.html">HASH_Entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00015.html#aa0f01a8d9a72c6a69d0891fd81076bee">HASH_find_in_bucket</a> (<a class="el" href="a00010.html">SRING</a> *abucket, <a class="el" href="a00022.html#a0add298fa768754c300d2489164b8677">HASH_VALUE</a> hash, <a class="el" href="a00016.html#af9eab147ddd898a2d7fb376e1f8753a3">HASH_COMPARE_KEY</a> compare_key, void *key, ssize_t key_size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="a00004.html">HASH_Entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00015.html#a072fef06fb9a516f47771ddd3946bf20">HASH_find</a> (<a class="el" href="a00003.html">HASH</a> *phash, void *key, ssize_t key_size)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">find entry with given key in hash table; for multimaps this will return the first occurence of the key.  <a href="#a072fef06fb9a516f47771ddd3946bf20"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="a00004.html">HASH_Entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00015.html#a2f20017ef2a49dc235a8bea78b254dd6">HASH_find_next</a> (<a class="el" href="a00003.html">HASH</a> *phash, <a class="el" href="a00004.html">HASH_Entry</a> *prev, void *key, ssize_t key_size)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">for multimaps - find next occurence of key  <a href="#a2f20017ef2a49dc235a8bea78b254dd6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00015.html#af9ce37d092fe7b3ae217336ef623a7dc">HASH_insert</a> (<a class="el" href="a00003.html">HASH</a> *phash, <a class="el" href="a00004.html">HASH_Entry</a> *entry, void *key, ssize_t key_size)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">insert new entry in hash table  <a href="#af9ce37d092fe7b3ae217336ef623a7dc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="a00004.html">HASH_Entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00015.html#a3841ec1a9db3bcb2cd6dbd2ba36c4550">HASH_unlink</a> (<a class="el" href="a00003.html">HASH</a> *phash, void *key, ssize_t key_size)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">find first hash table entry and unlink it from its bucket. The caller of this function has to free memory held by hash table entry.  <a href="#a3841ec1a9db3bcb2cd6dbd2ba36c4550"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="acb4c58835714882f70736b2c45188ff4"></a><!-- doxytag: member="bhash.c::ADJUST_HASH" ref="acb4c58835714882f70736b2c45188ff4" args="(hash, buckets)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADJUST_HASH</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">hash, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">buckets&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;((hash) &amp; ((buckets) - 1))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00015_source.html#l00009">9</a> of file <a class="el" href="a00015_source.html">bhash.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a072fef06fb9a516f47771ddd3946bf20"></a><!-- doxytag: member="bhash.c::HASH_find" ref="a072fef06fb9a516f47771ddd3946bf20" args="(HASH *phash, void *key, ssize_t key_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00004.html">HASH_Entry</a>* HASH_find </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00003.html">HASH</a> *&#160;</td>
          <td class="paramname"><em>phash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ssize_t&#160;</td>
          <td class="paramname"><em>key_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>find entry with given key in hash table; for multimaps this will return the first occurence of the key. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">phash</td><td>(in) the object </td></tr>
    <tr><td class="paramname">key</td><td>(in) pointer to key </td></tr>
    <tr><td class="paramname">key_size</td><td>(in) size of key</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>pointer to entry if found; NULL if not found </dd></dl>

<p>Definition at line <a class="el" href="a00015_source.html#l00119">119</a> of file <a class="el" href="a00015_source.html">bhash.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="a00022.html#a0add298fa768754c300d2489164b8677">HASH_VALUE</a> hash = phash-&gt;<a class="code" href="a00003.html#aa8d9ed13981a492e221f55d4a0ff8a9b">hash_func</a>( key, key_size );
        <span class="keywordtype">int</span>             bucket =   <a class="code" href="a00015.html#acb4c58835714882f70736b2c45188ff4">ADJUST_HASH</a>(hash, phash-&gt;<a class="code" href="a00003.html#a13b4c75f393b997dc965cef4fc2508c1">buckets_size</a>);
        <a class="code" href="a00010.html" title="Single linked circular list data structure; where each list element can be of different length...">SRING</a>   *abucket = &amp;phash-&gt;<a class="code" href="a00003.html#a7ec749b263c20879444d18b7ab4824e8">buckets</a>[ bucket ];   
        
        <span class="keywordflow">return</span> <a class="code" href="a00015.html#aa0f01a8d9a72c6a69d0891fd81076bee">HASH_find_in_bucket</a>( abucket, hash, phash-&gt;<a class="code" href="a00003.html#a9f012f5c0abfa8de8f6ff6d98a3d5f83">compare_key</a>, key, key_size );
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa0f01a8d9a72c6a69d0891fd81076bee"></a><!-- doxytag: member="bhash.c::HASH_find_in_bucket" ref="aa0f01a8d9a72c6a69d0891fd81076bee" args="(SRING *abucket, HASH_VALUE hash, HASH_COMPARE_KEY compare_key, void *key, ssize_t key_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00004.html">HASH_Entry</a>* HASH_find_in_bucket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00010.html">SRING</a> *&#160;</td>
          <td class="paramname"><em>abucket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00022.html#a0add298fa768754c300d2489164b8677">HASH_VALUE</a>&#160;</td>
          <td class="paramname"><em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00016.html#af9eab147ddd898a2d7fb376e1f8753a3">HASH_COMPARE_KEY</a>&#160;</td>
          <td class="paramname"><em>compare_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ssize_t&#160;</td>
          <td class="paramname"><em>key_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00015_source.html#l00097">97</a> of file <a class="el" href="a00015_source.html">bhash.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="a00010.html" title="Single linked circular list data structure; where each list element can be of different length...">SRING</a>   *pos;

        <a class="code" href="a00028.html#a39582582e3bfccf18e39710e75009ad1" title="Macro for iterate over all elements of a list, the list is traversed in forward direction from first ...">SRING_FOREACH</a>(pos, abucket) {
                <a class="code" href="a00004.html" title="Entry in bucket hash table Each hash table entry has to embed a VBUCKETHASH_Entry as part of its stru...">HASH_Entry</a> *entry = (<a class="code" href="a00004.html" title="Entry in bucket hash table Each hash table entry has to embed a VBUCKETHASH_Entry as part of its stru...">HASH_Entry</a> *) pos;
                <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="a00004.html#a0a321e75db9083da90e2557e6cc24de8">hash</a> == hash) 
                {
                        <span class="keywordflow">if</span> (compare_key( entry, key, key_size ) == 0) {
                                <span class="keywordflow">return</span> entry;
                        }
                }
        }
        <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2f20017ef2a49dc235a8bea78b254dd6"></a><!-- doxytag: member="bhash.c::HASH_find_next" ref="a2f20017ef2a49dc235a8bea78b254dd6" args="(HASH *phash, HASH_Entry *prev, void *key, ssize_t key_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00004.html">HASH_Entry</a>* HASH_find_next </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00003.html">HASH</a> *&#160;</td>
          <td class="paramname"><em>phash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00004.html">HASH_Entry</a> *&#160;</td>
          <td class="paramname"><em>prev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ssize_t&#160;</td>
          <td class="paramname"><em>key_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>for multimaps - find next occurence of key </p>
<p>Usage to retrive all occurences of a key</p>
<p><a class="el" href="a00004.html" title="Entry in bucket hash table Each hash table entry has to embed a VBUCKETHASH_Entry as part of its stru...">HASH_Entry</a> * entry; for( entry = HASH_find(hash, key, sizeof(key) ) ; entry; entry = HASH_find_next(hash, entry, key, sizeof(key) ) {</p>
<p>}</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">phash</td><td>(in) the object </td></tr>
    <tr><td class="paramname">prev</td><td>(in) value returned by first invocation of VBUCKETHASH_find or previous invocation of VBUCKETHASH_find_next </td></tr>
    <tr><td class="paramname">key</td><td>(in) pointer to key </td></tr>
    <tr><td class="paramname">key_size</td><td>(in) size of key. If key is a null terminated string then pass VHASH_STRING as value. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>pointer to entry if found; NULL if not found </dd></dl>

<p>Definition at line <a class="el" href="a00015_source.html#l00128">128</a> of file <a class="el" href="a00015_source.html">bhash.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="a00004.html" title="Entry in bucket hash table Each hash table entry has to embed a VBUCKETHASH_Entry as part of its stru...">HASH_Entry</a> *next;

        <span class="keywordflow">if</span> (!phash-&gt;<a class="code" href="a00003.html#a1e56521c716b07928dc326eced3b50c0">ismultimap</a>) {
                <span class="keywordflow">return</span> 0;
        }

        next = (<a class="code" href="a00004.html" title="Entry in bucket hash table Each hash table entry has to embed a VBUCKETHASH_Entry as part of its stru...">HASH_Entry</a> *) prev-&gt;<a class="code" href="a00004.html#a41027b39fbfa250c8b29c79a4634e7f5">entry</a>.<a class="code" href="a00010.html#a9842e33c47a3fff2a6ddec4078ef7190">next</a>;
        if (!next) {
                <span class="keywordflow">return</span> 0;
        }
        <span class="keywordflow">if</span> (next-&gt;<a class="code" href="a00004.html#a0a321e75db9083da90e2557e6cc24de8">hash</a> != prev-&gt;<a class="code" href="a00004.html#a0a321e75db9083da90e2557e6cc24de8">hash</a>) {
                <span class="keywordflow">return</span> 0;
        }
        <span class="keywordflow">if</span> (phash-&gt;<a class="code" href="a00003.html#a9f012f5c0abfa8de8f6ff6d98a3d5f83">compare_key</a>( next, key, key_size ) != 0) {
                <span class="keywordflow">return</span> 0;
        }
        <span class="keywordflow">return</span> next;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a73ce0ca18399c5db0bac0491aeadba8d"></a><!-- doxytag: member="bhash.c::HASH_init" ref="a73ce0ca18399c5db0bac0491aeadba8d" args="(HASH *hash, size_t buckets, int ismultimap, HASH_COMPARE_KEY compare_key, HASH_FUNCTION hash_func)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HASH_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00003.html">HASH</a> *&#160;</td>
          <td class="paramname"><em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>buckets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ismultimap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00016.html#af9eab147ddd898a2d7fb376e1f8753a3">HASH_COMPARE_KEY</a>&#160;</td>
          <td class="paramname"><em>compare_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00016.html#a11718c21601b9ee597d31cb7e720c260">HASH_FUNCTION</a>&#160;</td>
          <td class="paramname"><em>hash_func</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Object constructor; initialise the hash that allows one entry for a given key. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">hash</td><td>(out) the object. </td></tr>
    <tr><td class="paramname">buckets</td><td>(in) number of buckets - will be rounded to closes power of two (i.e. number of arrays of linked lists structures, each separate list holds elements with same hash number). </td></tr>
    <tr><td class="paramname">hash_func</td><td>(in) pointer to hash function </td></tr>
    <tr><td class="paramname">compare</td><td>(in) pointer to compare function; compares if two keys are equal, (called when hash value of two entries is equal)</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if ok </dd></dl>

<p>Definition at line <a class="el" href="a00015_source.html#l00013">13</a> of file <a class="el" href="a00015_source.html">bhash.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">size_t</span> i;

        buckets = <a class="code" href="a00032.html#a191e663cb1cc920f6b50f17567ea8c5c">UTIL_round_to_power_of_n</a>( buckets );


        hash-&gt;<a class="code" href="a00003.html#adfd1d7fb9add98a87d2852e45c7cd018">elmcount</a> = 0;

        <span class="keywordflow">if</span> (!hash_func) {
          hash-&gt;<a class="code" href="a00003.html#aa8d9ed13981a492e221f55d4a0ff8a9b">hash_func</a> = <a class="code" href="a00021.html#a1498645507ca3a2df89dabf640fde50d" title="One at a time by Bob Jenkins.">HASHFUNCTION_Bob_Jenkins_one_at_a_time</a>;
        } <span class="keywordflow">else</span> {
          hash-&gt;<a class="code" href="a00003.html#aa8d9ed13981a492e221f55d4a0ff8a9b">hash_func</a> = hash_func;
        }
        hash-&gt;<a class="code" href="a00003.html#a9f012f5c0abfa8de8f6ff6d98a3d5f83">compare_key</a> = compare_key;

        hash-&gt;<a class="code" href="a00003.html#a1e56521c716b07928dc326eced3b50c0">ismultimap</a> = ismultimap;

        hash-&gt;<a class="code" href="a00003.html#a7ec749b263c20879444d18b7ab4824e8">buckets</a> = (<a class="code" href="a00010.html" title="Single linked circular list data structure; where each list element can be of different length...">SRING</a> *) malloc( <span class="keyword">sizeof</span>(<a class="code" href="a00010.html" title="Single linked circular list data structure; where each list element can be of different length...">SRING</a>) * buckets );
        <span class="keywordflow">if</span> (!hash-&gt;<a class="code" href="a00003.html#a7ec749b263c20879444d18b7ab4824e8">buckets</a>) {
                <span class="keywordflow">return</span> -1;
        }
        hash-&gt;<a class="code" href="a00003.html#a13b4c75f393b997dc965cef4fc2508c1">buckets_size</a> = buckets;
        
        <span class="keywordflow">for</span>(i=0;i&lt;buckets;i++) {
          <a class="code" href="a00028.html#a53ac9788c8cdc9e03a9e343fd7e8b15a" title="initialises an empty list head">SRING_init</a>(  &amp;hash-&gt;<a class="code" href="a00003.html#a7ec749b263c20879444d18b7ab4824e8">buckets</a>[i] );
        }


        hash-&gt;<a class="code" href="a00003.html#a8713031ba9a40fa717f1d3b8114691c0">mult_load_factor</a> = 2;
        hash-&gt;<a class="code" href="a00003.html#a6f4e674640c97d88dfd2e557d660f147">div_load_factor</a> = 3;

        hash-&gt;<a class="code" href="a00003.html#a00bd0beb9248ca36fff916569eb71526">resize_threshold</a> = (buckets * hash-&gt;<a class="code" href="a00003.html#a8713031ba9a40fa717f1d3b8114691c0">mult_load_factor</a>) / hash-&gt;<a class="code" href="a00003.html#a6f4e674640c97d88dfd2e557d660f147">div_load_factor</a>;

        <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af9ce37d092fe7b3ae217336ef623a7dc"></a><!-- doxytag: member="bhash.c::HASH_insert" ref="af9ce37d092fe7b3ae217336ef623a7dc" args="(HASH *phash, HASH_Entry *entry, void *key, ssize_t key_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HASH_insert </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00003.html">HASH</a> *&#160;</td>
          <td class="paramname"><em>phash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00004.html">HASH_Entry</a> *&#160;</td>
          <td class="paramname"><em>entry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ssize_t&#160;</td>
          <td class="paramname"><em>key_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>insert new entry in hash table </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">hash</td><td>(in) the object </td></tr>
    <tr><td class="paramname">key</td><td>(in) key </td></tr>
    <tr><td class="paramname">size</td><td>(in) size of key. If key is a null terminated string then pass VHASH_STRING as value. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00015_source.html#l00149">149</a> of file <a class="el" href="a00015_source.html">bhash.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="a00022.html#a0add298fa768754c300d2489164b8677">HASH_VALUE</a> hash;
        <span class="keywordtype">int</span>             bucket;
        <a class="code" href="a00010.html" title="Single linked circular list data structure; where each list element can be of different length...">SRING</a>   *abucket,*fnd;

        <span class="keywordflow">if</span> ((phash-&gt;<a class="code" href="a00003.html#adfd1d7fb9add98a87d2852e45c7cd018">elmcount</a> + 1) &gt;= phash-&gt;<a class="code" href="a00003.html#a00bd0beb9248ca36fff916569eb71526">resize_threshold</a>) {

           <span class="keywordflow">if</span> (<a class="code" href="a00015.html#acef4d862b25db1563ce621265299fb2e" title="resize the hash table">HASH_resize</a>(phash, 2 * phash-&gt;<a class="code" href="a00003.html#a13b4c75f393b997dc965cef4fc2508c1">buckets_size</a>)) {
             <span class="keywordflow">return</span> -1;
           }
        }

        hash = phash-&gt;<a class="code" href="a00003.html#aa8d9ed13981a492e221f55d4a0ff8a9b">hash_func</a>( key, key_size );       
        entry-&gt;<a class="code" href="a00004.html#a0a321e75db9083da90e2557e6cc24de8">hash</a> = hash;

        bucket =   <a class="code" href="a00015.html#acb4c58835714882f70736b2c45188ff4">ADJUST_HASH</a>(hash, phash-&gt;<a class="code" href="a00003.html#a13b4c75f393b997dc965cef4fc2508c1">buckets_size</a>);
        abucket = &amp;phash-&gt;<a class="code" href="a00003.html#a7ec749b263c20879444d18b7ab4824e8">buckets</a>[ bucket ];   
        
        
        fnd = (<a class="code" href="a00010.html" title="Single linked circular list data structure; where each list element can be of different length...">SRING</a> *) <a class="code" href="a00015.html#aa0f01a8d9a72c6a69d0891fd81076bee">HASH_find_in_bucket</a>( abucket, hash, phash-&gt;<a class="code" href="a00003.html#a9f012f5c0abfa8de8f6ff6d98a3d5f83">compare_key</a>, key, key_size );

        <span class="comment">/* multimap allows only one entry with the given key */</span>
        <span class="keywordflow">if</span> (!phash-&gt;<a class="code" href="a00003.html#a1e56521c716b07928dc326eced3b50c0">ismultimap</a> &amp;&amp; fnd) {
                <span class="keywordflow">return</span> -1;
        }

        <span class="keywordflow">if</span> (fnd) {
                <a class="code" href="a00028.html#a6a2a1950260f3fb3d385bde480e5c976" title="insert new entry after a given entry.">SRING_insert_after</a>( fnd, &amp;entry-&gt;<a class="code" href="a00004.html#a41027b39fbfa250c8b29c79a4634e7f5">entry</a> );
        } <span class="keywordflow">else</span> {
                <a class="code" href="a00028.html#a608f3b7787a81834f15eddbc4135d04f">SRING_push_front</a>( abucket,  &amp;entry-&gt;<a class="code" href="a00004.html#a41027b39fbfa250c8b29c79a4634e7f5">entry</a> );
        }
        phash-&gt;<a class="code" href="a00003.html#adfd1d7fb9add98a87d2852e45c7cd018">elmcount</a>++;

        <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acef4d862b25db1563ce621265299fb2e"></a><!-- doxytag: member="bhash.c::HASH_resize" ref="acef4d862b25db1563ce621265299fb2e" args="(HASH *hash, size_t buckets)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HASH_resize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00003.html">HASH</a> *&#160;</td>
          <td class="paramname"><em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>buckets</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>resize the hash table </p>
<p>Change number of buckets in hash table. The function pass over each element in the hash table and insert it into the resized table.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">hash</td><td>(in out) the object </td></tr>
    <tr><td class="paramname">buckets</td><td>(in) new number of buckets </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00015_source.html#l00060">60</a> of file <a class="el" href="a00015_source.html">bhash.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="a00010.html" title="Single linked circular list data structure; where each list element can be of different length...">SRING</a> *pbuckets;
        <span class="keywordtype">size_t</span> i;
        <a class="code" href="a00004.html" title="Entry in bucket hash table Each hash table entry has to embed a VBUCKETHASH_Entry as part of its stru...">HASH_Entry</a> *cur;
        <span class="keywordtype">size_t</span> elmcount;

        buckets = <a class="code" href="a00032.html#a191e663cb1cc920f6b50f17567ea8c5c">UTIL_round_to_power_of_n</a>( buckets );

        pbuckets = malloc( <span class="keyword">sizeof</span>(<a class="code" href="a00010.html" title="Single linked circular list data structure; where each list element can be of different length...">SRING</a>) * buckets);
        <span class="keywordflow">if</span> (!pbuckets) {
                <span class="keywordflow">return</span> -1;
        }
        <span class="keywordflow">for</span>(i=0;i&lt;buckets;i++) {
                <a class="code" href="a00028.html#a53ac9788c8cdc9e03a9e343fd7e8b15a" title="initialises an empty list head">SRING_init</a>( pbuckets + i );
        }

        elmcount = hash-&gt;<a class="code" href="a00003.html#adfd1d7fb9add98a87d2852e45c7cd018">elmcount</a>;

        <a class="code" href="a00016.html#a1193ff43ed7c2f743c974d75c39efc93" title="Macro: iterate over all elements in hash table and delete them from the table; allow the user to free...">HASH_DELETEALL</a>(cur,hash)
                i = <a class="code" href="a00015.html#acb4c58835714882f70736b2c45188ff4">ADJUST_HASH</a>(  cur-&gt;hash, buckets);
                <a class="code" href="a00028.html#a608f3b7787a81834f15eddbc4135d04f">SRING_push_front</a>( pbuckets + i, (<a class="code" href="a00010.html" title="Single linked circular list data structure; where each list element can be of different length...">SRING</a> *) cur);
        <a class="code" href="a00016.html#aee7185cd320df1c4a801762c8f5201b6" title="Macro: close block opened by HASH_DELETEALL.">HASH_DELETEALL_END</a>

        free( hash-&gt;buckets );

        hash-&gt;buckets = pbuckets;
        hash-&gt;buckets_size = buckets;
        hash-&gt;elmcount = elmcount;


        hash-&gt;resize_threshold = (buckets * hash-&gt;mult_load_factor) / hash-&gt;div_load_factor;

        return 0;

}
</pre></div>
</div>
</div>
<a class="anchor" id="a3841ec1a9db3bcb2cd6dbd2ba36c4550"></a><!-- doxytag: member="bhash.c::HASH_unlink" ref="a3841ec1a9db3bcb2cd6dbd2ba36c4550" args="(HASH *phash, void *key, ssize_t key_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00004.html">HASH_Entry</a>* HASH_unlink </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00003.html">HASH</a> *&#160;</td>
          <td class="paramname"><em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ssize_t&#160;</td>
          <td class="paramname"><em>key_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>find first hash table entry and unlink it from its bucket. The caller of this function has to free memory held by hash table entry. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">hash</td><td></td></tr>
    <tr><td class="paramname">key</td><td></td></tr>
    <tr><td class="paramname">size</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>if entry with given keys exists - pointer to hash table entry. </dd></dl>

<p>Definition at line <a class="el" href="a00015_source.html#l00186">186</a> of file <a class="el" href="a00015_source.html">bhash.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="a00022.html#a0add298fa768754c300d2489164b8677">HASH_VALUE</a> hash;
        <span class="keywordtype">int</span>             bucket;
        <a class="code" href="a00010.html" title="Single linked circular list data structure; where each list element can be of different length...">SRING</a>   *abucket;
        <a class="code" href="a00010.html" title="Single linked circular list data structure; where each list element can be of different length...">SRING</a>   *pos,*prev;
        <a class="code" href="a00004.html" title="Entry in bucket hash table Each hash table entry has to embed a VBUCKETHASH_Entry as part of its stru...">HASH_Entry</a> *ret = 0;


        hash =  phash-&gt;<a class="code" href="a00003.html#aa8d9ed13981a492e221f55d4a0ff8a9b">hash_func</a>( key, key_size );      
        bucket =   <a class="code" href="a00015.html#acb4c58835714882f70736b2c45188ff4">ADJUST_HASH</a>(hash, phash-&gt;<a class="code" href="a00003.html#a13b4c75f393b997dc965cef4fc2508c1">buckets_size</a>);
        abucket = &amp;phash-&gt;<a class="code" href="a00003.html#a7ec749b263c20879444d18b7ab4824e8">buckets</a>[ bucket ];   

        prev = abucket;
        <a class="code" href="a00028.html#a39582582e3bfccf18e39710e75009ad1" title="Macro for iterate over all elements of a list, the list is traversed in forward direction from first ...">SRING_FOREACH</a>(pos, abucket) {
                <a class="code" href="a00004.html" title="Entry in bucket hash table Each hash table entry has to embed a VBUCKETHASH_Entry as part of its stru...">HASH_Entry</a> *entry = (<a class="code" href="a00004.html" title="Entry in bucket hash table Each hash table entry has to embed a VBUCKETHASH_Entry as part of its stru...">HASH_Entry</a> *) pos;

                <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="a00004.html#a0a321e75db9083da90e2557e6cc24de8">hash</a> == hash) {
                  
                        <span class="keywordflow">if</span> (phash-&gt;<a class="code" href="a00003.html#a9f012f5c0abfa8de8f6ff6d98a3d5f83">compare_key</a>( entry, key, key_size ) == 0) {
                                ret = (<a class="code" href="a00004.html" title="Entry in bucket hash table Each hash table entry has to embed a VBUCKETHASH_Entry as part of its stru...">HASH_Entry</a> *) <a class="code" href="a00028.html#ab573cc304039b055762f9251cc551d36">SRING_unlink_after</a>(prev);
                                phash-&gt;<a class="code" href="a00003.html#adfd1d7fb9add98a87d2852e45c7cd018">elmcount</a>--;      
                                <span class="keywordflow">return</span> ret;
                        }
                }
                prev = pos;
        }

        <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Aug 23 2011 18:31:22 for Simple data structures / objects in plain C by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
